less important code
about 300 lines